import streamlit as st
import yfinance as yf
import plotly.graph_objects as go
import pandas as pd

st.title("ğŸ¯ AI Smart Trader â€” Ø§Ù„Ø±Ø³Ù… Ùˆ Ø§Ù„Ø´Ù…ÙˆØ¹ Ø§Ù„ÙŠØ§Ø¨Ø§Ù†ÙŠØ©")

# --- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ù‡Ù… ---
symbol = st.text_input("Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø³Ù‡Ù…", "AAPL")

# --- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ---
start_date = st.date_input("ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©", pd.to_datetime("2020-11-28"))
end_date = st.date_input("ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©", pd.to_datetime("2025-11-28"))

# --- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
df = yf.download(symbol, start=start_date, end=end_date)

if df.empty:
    st.error("âš  Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø³Ù‡Ù… Ø£Ùˆ Ø§Ù„ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ­ÙŠØ­")
    st.stop()

# ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
df = df[['Open', 'High', 'Low', 'Close', 'Volume']]
df.reset_index(inplace=True)

# --- Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ù… ---
chart_type = st.radio("Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ù…", ["Ø§Ù„Ø´Ù…ÙˆØ¹ Ø§Ù„ÙŠØ§Ø¨Ø§Ù†ÙŠØ©", "Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ø¹Ø§Ø¯ÙŠ"])

st.write("### ğŸ“Š Ø§Ù„Ø±Ø³Ù…:")

# --- Ø§Ù„Ø´Ù…ÙˆØ¹ Ø§Ù„ÙŠØ§Ø¨Ø§Ù†ÙŠØ© ---
if chart_type == "Ø§Ù„Ø´Ù…ÙˆØ¹ Ø§Ù„ÙŠØ§Ø¨Ø§Ù†ÙŠØ©":
    fig = go.Figure(data=[go.Candlestick(
        x=df['Date'],
        open=df['Open'],
        high=df['High'],
        low=df['Low'],
        close=df['Close']
    )])
    fig.update_layout(title=f"Candlestick â€” {symbol}", xaxis_title="Ø§Ù„ØªØ§Ø±ÙŠØ®", yaxis_title="Ø§Ù„Ø³Ø¹Ø±")
    st.plotly_chart(fig, use_container_width=True)

# --- Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ø¹Ø§Ø¯ÙŠ ---
else:
    fig = go.Figure()
    fig.add_trace(go.Scatter(
        x=df['Date'],
        y=df['Close'],
        mode='lines',
        name='Close'
    ))
    fig.update_layout(title=f"Line Chart â€” {symbol}", xaxis_title="Ø§Ù„ØªØ§Ø±ÙŠØ®", yaxis_title="Ø§Ù„Ø³Ø¹Ø±")
    st.plotly_chart(fig, use_container_width=True)

# --- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
st.write("### ğŸ“ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± (Ø¢Ø®Ø± 100 ÙŠÙˆÙ…)")
st.dataframe(df.tail(100))